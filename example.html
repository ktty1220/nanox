<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>Nanox example</title>
  </head>
  <body>
    <div id="app"></div>
    <script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.38/browser.min.js"></script>
    <script src="./dist/nanox.js"></script>
    <script type="text/babel">
      const { memo, createContext, useContext, useCallback } = React;

      /**
       * Create actions
       */
      const actions = {
        // action name is 'increment'
        increment(count) {
          // return update command
          return this.update({
            count: { $increment: count }
          });
        },

        // action name is 'decrement'
        decrement(count) {
          // you can return Promise Object that resolve partial state
          return new Promise((resolve, reject) => {
            setTimeout(() => {
              // get current state
              const currentState = this.getState();

              // resolve partial state that you want to update
              resolve({
                count: currentState.count - count
              });
            }, 1000);
          });
        }
      };

      /**
       * Create Context
       */
      const Context = createContext();

      /**
       * Create Child Component
       */
      const CounterComponent = memo(({ count }) => {
        // receive dispatch function via context
        const dispatch = useContext(Context);

        // create dispatch function with action name and arguments
        const increment1 = useCallback(() => dispatch('increment', 1), []);
        const decrement1 = useCallback(() => dispatch('decrement', 1), []);
        const increment100 = useCallback(() => dispatch('increment', 100), []);

        return (
          <div>
            <div>{count}</div>
            <button onClick={increment1}>+1</button>
            <button onClick={decrement1}>-1(delay 1s)</button>
            <button onClick={increment100}>+100</button>
          </div>
        );
      });

      /**
       * Create Nanox Container
       */
      // create container (inherit Nanox)
      class MainContainer extends Nanox {
        constructor(props) {
          super(props);
          this.state = { count: 0 };
        }

        onDispatch(action, ...args) {
          console.info('action dispatched', { action, args });
          //return false;
        }

        onSetState(data, type) {
          console.info('state will update', { data, type });
          //return false;
        }

        componentWillUpdate(props, state) {
          console.info('new state', state);
        }

        render() {
          return (
            // pass this.dispatch to child component via context
            <Context.Provider value={this.dispatch}>
              <CounterComponent count={this.state.count} />
              <p>Look at the logs displayed on the Developer Tools console.</p>
            </Context.Provider>
          );
        }
      }

      // mount Nanox container to DOM
      ReactDOM.render(
        // set actions to container
        <MainContainer actions={actions} />,
        document.getElementById('app')
      );
    </script>
  </body>
</html>
